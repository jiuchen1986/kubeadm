- block:

  - name: install docker, apt-transport-https, curl
    shell: apt-get update && apt-get install -y docker.io apt-transport-https curl

  - name: start docker service
    shell: systemctl enable docker && systemctl start docker

  - name: add kubernetes repo's gpg key
    shell: curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -

  - name: add kubernetes apt repo
    shell: echo "deb http://apt.kubernetes.io/ kubernetes-xenial main" > /etc/apt/sources.list.d/kubernetes.list

  - name: install kubelet, kubeadm, kubectl
    shell: apt-get update && apt-get install -y kubelet kubeadm kubectl

  - name: start kubelet service
    shell: systemctl daemon-reload && systemctl restart kubelet


  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

- block:

  - name: install docker
    shell: yum install -y docker

  - name: start docker service
    shell: systemctl enable docker && systemctl start docker

  - name: add kubernetes yum repo
    copy:
      src: kubernetes.repo
      dest: /etc/yum.repos.d/kubernetes.repo

  - name: disable selinux
    shell: setenforce 0

  - name: config sysctl
    copy:
      src: k8s.conf
      dest: /etc/sysctl.d/k8s.conf

  - shell: sysctl --system

  - name: install kubelet, kubeadm, kubectl
    shell: yum install -y kubelet kubeadm kubectl

  - name: start kubelet service
    shell: systemctl enable kubelet && systemctl start kubelet


  when: ansible_distribution == 'CentOS' or ansible_distribution == 'RedHat'
  
